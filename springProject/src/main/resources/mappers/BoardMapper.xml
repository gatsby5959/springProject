<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.myweb.www.repository.BoardDAO">
     <insert id="insert" parameterType="com.myweb.www.domain.BoardVO">
        insert into board(title,writer,content)
        values(#{title},#{writer},#{content})
     </insert>
     	
     	
<!--     <select id = "getList" resultType="com.myweb.www.domain.BoardVO"> -->
<!-- 		select * from board order by bno desc; -->
<!-- 	</select> -->
	
	<select id = "getList" resultType="com.myweb.www.domain.BoardVO">
		select * from board 
		<include refid="search"></include>
		order by bno desc limit #{pageStart}, #{qty}
	</select>

	
	
	<select id = "getDetail"  parameterType="int"
							 resultType="com.myweb.www.domain.BoardVO">
		select * from board where bno = #{bno}
	</select>
	
	<update id = "update" parameterType = "com.myweb.www.domain.BoardVO">
		update board set title = #{title}, content=#{content}, mod_at = now()
		 where bno= #{bno};
	</update>
	
	<delete id = "remove" parameterType = "int">
		delete from board where bno= #{bno};
	</delete>
	
	<update id = "readCount"> <!-- 파라미터 타입은 사실 안줘도 동작합 인트 등... 어자피 들어오는건 이미 규격을 달고 옴 int같은거... 다른 양식 2개 들어오면... 걍 안적음 -->
		update board set read_count = read_count + 1 where bno= #{readCount};
	</update>
	
	<select id ="getTotalCount" resultType = "int">
		select count(bno) from board <include refid="search"></include>
	</select>
	
	<sql id = "search">
	 <if test = "type != null">
	 	<trim prefix="where("  suffix=")" prefixOverrides="OR">
	 		<foreach collection="typeToArray" item="type">
	 			<trim prefix="OR">
	 				<choose>
	 					<when test="type == 't'.toString">
	 						title like concat('%', #{keyword},'%')
	 					</when>
	 					<when test="type == 'w'.toString">
	 						writer like concat('%', #{keyword},'%')
	 					</when>
	 					<when test="type == 'c'.toString">
	 						content like concat('%', #{keyword},'%')
	 					</when>
	 				</choose>
	 			</trim>
	 		</foreach>
	 	</trim>
	 </if>
	</sql>
	
  </mapper>